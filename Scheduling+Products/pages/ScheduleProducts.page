<apex:page docType="html-5.0" standardController="Opportunity" sidebar="false" extensions="ScheduleProductsController">
	<apex:pageMessages />
    <apex:form >
        <apex:pageBlock title="No Products on Opportunity" rendered="{!wrapOLIList.size=0}">
                <apex:commandLink value="Add Products" action="{!addProduct}">
                    <apex:param name="addProductsURL" value="/p/opp/SelectSearch?addTo=oppid" assignTo="{!addProductsURL}"/>
                </apex:commandLink>
                or click 'Back' to return to the opportunity.
                <apex:pageBlockButtons location="top">
                    <apex:commandButton value="Back" action="{!cancel}"/>
                </apex:pageBlockButtons>
        </apex:pageBlock>
        <apex:pageBlock title="Select Products" rendered="{!AND(wrapOLIList.size!=0,OR(newqSCHS = null, newrSCHs = null))}">
        	<apex:pageBlockSection columns="1">
                <apex:pageBlockTable var="OLI" value="{!wrapOLIList}">
                    <apex:column headerValue="Select">
                        <apex:inputCheckbox value="{!OLI.isSelected}" id="selected"/>
                    </apex:column>
                    <apex:column headerValue="Product Name" value="{!OLI.OLIName}"/>
                    <apex:column headerValue="Product Code" value="{!OLI.OLIProductCode}"/>
                    <apex:column headerValue="Quantity">
                      	<apex:outputText value="{0, number, 0}">
                            <apex:param value="{!OLI.OLIQuantity}"/>
                        </apex:outputText>
                    </apex:column>
                    <apex:column headerValue="Total Price">
                        <apex:outputText value="{0, number, ###,###,###,###,##0.00}">
                            <apex:param value="{!OLI.OLITotalPrice}"/>
                        </apex:outputText>
                    </apex:column>
                </apex:pageBlockTable> 
            </apex:pageBlockSection>
            <apex:pageBlockButtons location="top">
                <apex:commandButton action="{!cancel}" value="Done" immediate="true" html-formnovalidate="formnovalidate"/>
            </apex:pageBlockButtons>
        </apex:pageBlock>
        <apex:pageBlock title="Establish Schedule" rendered="{!AND(wrapOLIList.size!=0,OR(newqSCHS = null, newrSCHs = null))}">
            <apex:pageBlockSection title="Choose Schedule Type(s)" collapsible="false" columns="1">
                <apex:outputLabel value="Type" for="theType"/> 
                <apex:actionRegion >
                    <apex:selectList value="{!tempSCH.scheduleBy}" Label="Type" size="1" required="true" id="theType">
                        <apex:selectOptions value="{!ScheduleByOptions}"/>
                        <apex:actionSupport event="onchange" reRender="theForm"/>
                    </apex:selectList>
                </apex:actionRegion>
            </apex:pageBlockSection>
            <apex:outputPanel id="theForm">
                <apex:outputPanel rendered="{!IF(OR(tempSCH.scheduleBy='Quantity and Revenue Schedules', tempSCH.scheduleBy='Quantity Schedule Only'),TRUE,FALSE)}">
                    <apex:pageBlockSection title="Establish Quantity Schedule for Selected Products" collapsible="false" columns="1">
                        <apex:input value="{!tempQSch.StartDate}" Label="Start Date" required="true" type="date" />
                        <apex:selectList value="{!tempQSch.scheduleType}" Label="Schedule Type" size="1" required="true">
                           <apex:selectOptions value="{!SplitOptions}"/> 
                        </apex:selectList>
                        <apex:selectList value="{!tempQSch.installmentType}" Label="Installment Period" size="1" required="true">
                            <apex:selectOptions value="{!TypeOptions}"/>
                        </apex:selectList>
                        <apex:input value="{!tempQSch.numofInstallments}" Label="Number of Installments" required="true" type="number"/>
                    </apex:pageBlockSection>
                </apex:outputPanel>
                <apex:outputPanel rendered="{!OR(tempSCH.scheduleBy='Quantity and Revenue Schedules', tempSCH.scheduleBy='Revenue Schedule Only')}">
                    <apex:pageBlockSection title="Establish Revenue Schedule for Selected Products" collapsible="false" columns="1">
                        <apex:input value="{!tempRSCH.StartDate}" Label="Start Date" required="true" type="date" />
                        <apex:selectList value="{!tempRSCH.scheduleType}" Label="Schedule Type" size="1" required="true">
                           <apex:selectOptions value="{!SplitOptions}"/> 
                        </apex:selectList>
                        <apex:selectList value="{!tempRSCH.installmentType}" Label="Installment Period" size="1" required="true">
                            <apex:selectOptions value="{!TypeOptions}"/>
                        </apex:selectList>
                        <apex:input value="{!tempRSCH.numofInstallments}" Label="Number of Installments" required="true" type="number"/>
                    </apex:pageBlockSection>
                </apex:outputPanel>
            </apex:outputPanel>
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton action="{!recalculate}" value="Establish"/>
            </apex:pageBlockButtons>
        </apex:pageBlock>
  		<apex:pageBlock title="New Schedules" rendered="{!OR(newqSCHS != null, newrSCHs != null)}">
           	<apex:pageBlockSection title="New Schedules" rendered="{!OR(newrSCHS != null, newrSCHS.size>0, newqSCHS != null, newqSCHs.size>0)}" collapsible="false" columns="1">
                <apex:pageBlockTable var="SCH" value="{!newSCHs}">
                    <apex:column value="{!SCH.OpportunityLineItem.Name}"/>
					<apex:column headerValue="Schedule Date">
                        <apex:inputField value="{!SCH.ScheduleDate}"/>
                    </apex:column>
                    <apex:column headerValue="Revenue">
                        <apex:inputField value="{!SCH.Revenue}"/>
                    </apex:column>
                    <apex:column headerValue="Quantity">
                        <apex:inputField value="{!SCH.Quantity}"/>
                    </apex:column>
                </apex:pageBlockTable> 
            </apex:pageBlockSection>
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton action="{!saveSchedule}" value="Save and Done" rendered="{!OR(newqSCHS != null, newqSCHs.size>0, newrSCHs != null, newqSCHs.size>0)}"/>
                <apex:commandButton action="{!saveAndMore}" value="Save and More" rendered="{!OR(newqSCHS != null, newqSCHs.size>0, newrSCHs != null, newqSCHs.size>0)}"/>
                <apex:commandButton action="{!cancel}" value="Cancel" rendered="{!OR(newqSCHS != null, newqSCHs.size>0, newrSCHs != null, newqSCHs.size>0)}"/>
            </apex:pageBlockButtons>
        </apex:pageBlock>
        <apex:pageBlock title="Existing Schedules" rendered="{!SCHs.size!=0}">
            <apex:pageBlockSection columns="1">
                <apex:pageBlockTable var="SCH" value="{!SCHs}">
                    <apex:column value="{!SCH.OpportunityLineItem.Name}"/>
					<apex:column value="{!SCH.ScheduleDate}"/>
                    <apex:column value="{!SCH.Revenue}"/>
                    <apex:column value="{!SCH.Quantity}"/>
                </apex:pageBlockTable> 
            </apex:pageBlockSection>
        </apex:pageBlock>
	</apex:form>
</apex:page>